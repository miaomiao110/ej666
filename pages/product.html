<style>
	.table {
		border-collapse: collapse;
		width: 100%;
		text-align: center;
	}
	.table td {
		border: 1px solid #ccc;
		line-height: 2em;
	}
	.table tr.current {
		background-color: #ededed;
	}
	.none {
		display: none;
	}
	.btn {
		padding: .5em 1em;
		border-radius: 3px;
		color: #333;
		border:1px solid #ccc;
		cursor: pointer;
		display: inline-block;
		background-color: teal;
	}
	.btns {
		margin-bottom: .5em;
	}
	.one{
		background-color: lightblue;
	}	
</style>
<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
<div class="customer">
	<div class="btns">
		<div id="btn_add" class="btn">添加</div>
		<div id="btn_batch_del" class="btn">批量删除</div>
	</div>
	
	<div style="margin-bottom: .5em">
		<!-- 表单 -->
		<form id="customer_form" action="javascript:void(0)">
			<input type="hidden" name="id" />
			商品名称<input type="text" name="name"/>
			商品描述<input type="text" name="description"/>
			价格 <input type="text" name="price"/>
			<input type="submit" value="提交">
		</form>
	</div>

	<table class="table" id="customer_tbl">
		<thead>
			<tr class="one">
				<td width="80px">编号</td>
				<td>商品名称</td>
				<td>商品描述</td>
				<td>价格</td>
				<td>所属分类</td>
				<td>图片</td>
				<td width="100px">操作</td>
			</tr>
		</thead>
		<tbody>
			
		</tbody>
	</table>
</div>
<script>
	var baseURL = "http://134.175.154.93:6677";
// 加载数据
    function reloadData(){
	    var url = baseURL+"/product/findAllProduct";
	    $.get(url,function(response,status){
		    //1. 将tbody清空
		    $("#customer_tbl tbody").empty();
		    //2. 追加新的值
		    response.data.forEach(function(item){
			    var newTr = $(`<tr>
				    <td><input type="checkbox" value="`+item.id+`"></td>
				    <td>`+item.name+`</td>
				    <td>`+item.description+`</td>
				    <td>`+item.price+`</td>
				    <td></td>
				    <td></td>
				    <td>
					    <a class="btn_del" href="#">删除</a>
					    <a class="btn_upd" href="#">更新</a>
				    </td>
			    </tr>`);
			    $("#customer_tbl").append(newTr)
		    });
	    }); 
    }
	// 为表单绑定事件
	$("tbody").on({
		mouseover:function(){
			this.className = "current"
		},
		mouseout:function(){
			this.className = ""
		}
	},'tr')
    // 给添加按钮绑定事件
    $("#btn_add").click(function(){
		$("#customer_form input[name=id]").val("");
		$("#customer_form input[name=name]").val("");
		$("#customer_form input[name=description]").val("");
		$("#customer_form input[name=price]").val("");
	    // 为表单绑定提交事件
	    $("#customer_form").submit(function(event){
		    //1. 获取表单元素的值
		    var id = $(this).find("input[name=id]").val();
		    var name = $(this).find("input[name=name]").val();
		    var description = $(this).find("input[name=description]").val();
		    var price = $(this).find("input[name=price]").val();
		    //2. 与后台进行交互
		    var data = {
			    id:id,
			    name:name,
			    description:description,
			    price:price
		    }
		    var url = baseURL+"/product/insertProduct";
		    $.post(url,data,function(result){
			    if(result.status === 200){
				    alert("保存成功");
				    // 更新页面
				    reloadData();
			    } else {
				    alert(result.message);
			    }
		    })

		    event.preventDefault();
	    });
    });
	// 为批量删除按钮绑定事件
	$("#btn_batch_del").click(function(){
		var ids = 
		$("#customer_tbl input:checkbox").filter(":checked")
		.map(function(index,item){
			return $(item).val()
		})
		.toArray();
		var data ="";
		for(var key in ids){
			var id = ids[key];
			if(key==0){
				data+="ids="+id
			} else {
				data+="&ids="+id
			}
		}

		$.ajax({
			url:baseURL+"/product/deleteBathProduct",
			method:"post",
			data:data,
			success:function(result){
				console.log(result);
				if(result.status === 200){
					alert("批量删除成功");
					// 更新页面
					reloadData();
				} else {
					alert(result.message);
				}
			}
		})
	})

	$("#customer_tbl").on("click","a",function(event){
		switch(this.className){
			case "btn_del":
				// 获取当前行的id
				var id = $(this).parents("tr").children().eq(0).find("input").val();
				// 交互
				var url = baseURL +"/product/deleteProductById";
				var data = {
					id:id
				}

				$.post(url,data,function(result){
					if(result.status === 200){
						// 更新页面
						reloadData();
					} else {
						alert(result.message);
					}
				});
				break;
			case "btn_upd":
				//1. 将当前行信息设置到表单中
				var id = $(this).parents("tr").children().eq(0).find("input").val();
				var name = $(this).parents("tr").children().eq(1).text();
				var description = $(this).parents("tr").children().eq(2).text();
				var price = $(this).parents("tr").children().eq(3).text();

				$("#customer_form input[name=id]").val(id);
				$("#customer_form input[name=name]").val(name);
				$("#customer_form input[name=description]").val(description);
				$("#customer_form input[name=price]").val(price);
				$("#customer_form").submit(function(event){
		            //1. 获取表单元素的值
		            var id = $(this).find("input[name=id]").val();
		            var name = $(this).find("input[name=name]").val();
		            var description = $(this).find("input[name=description]").val();
		            var price = $(this).find("input[name=price]").val();
		            //2. 与后台进行交互
		            var data = {
			            id:id,
			            name:name,
			            description:description,
			            price:price
		            }
		            var url = baseURL+"/product/updateProduct";
		            $.post(url,data,function(result){
			            if(result.status === 200){
				            alert("修改成功");
				            // 更新页面
				            reloadData();
			            } else {
				            alert(result.message);
			            }
		            })

		        event.preventDefault();
	        });
				break;
		}

		event.preventDefault();
	});
    reloadData();
</script>
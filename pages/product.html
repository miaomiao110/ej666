<style>
	.table {
		border-collapse: collapse;
		width: 100%;
		text-align: center;
	}
	.table td {
		border: 1px solid #ccc;
		line-height: 2em;
	}
	.table tr.current {
		background-color: #ededed;
	}
	.none {
		display: none;
	}
	.btn {
		padding: .5em 1em;
		border-radius: 3px;
		color: #333;
		border:1px solid #ccc;
		cursor: pointer;
		display: inline-block;
	}
	.btns {
		margin-bottom: .5em;
	}	
</style>
<!-- <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script> -->
<div class="customer">
	<div class="btns">
		<div id="btn_add" class="btn">添加</div>
		<div id="btn_import" class="btn">批量导入</div>
	</div>
	
	<div style="margin-bottom: .5em">
		<!-- 表单 -->
		<form action="javascript:void(0)">
			<input type="hidden" name="id" />
			商品名称<input type="text" name="name"/>
			商品描述<input type="text" name="description"/>
			价格 <input type="text" name="price"/>
			<input type="submit" value="提交">
		</form>
	</div>

	<table class="table" id="customer_tbl">
		<thead>
			<tr>
				<td width="80px">编号</td>
				<td>商品名称</td>
				<td>商品描述</td>
				<td>价格</td>
				<td>所属分类</td>
				<td>图片</td>
				<td width="100px">操作</td>
			</tr>
		</thead>
		<tbody>
			
		</tbody>
	</table>
</div>
<script>
	var baseURL = "http://134.175.154.93:6677";
// 加载数据
    function reloadData(){
	    var url = baseURL+"/product/findAllProduct";
	    $.get(url,function(response,status){
		    //1. 将tbody清空
		    $("#customer_tbl tbody").empty();
		    //2. 追加新的值
		    response.data.forEach(function(item){
			    var newTr = $(`<tr>
				    <td><input type="checkbox" value="`+item.id+`"></td>
				    <td>`+item.name+`</td>
				    <td>`+item.description+`</td>
				    <td>`+item.price+`</td>
				    <td></td>
				    <td></td>
				    <td>
					    <a class="btn_del" href="#">删除</a>
					    <a class="btn_upd" href="#">更新</a>
				    </td>
			    </tr>`);
			    $("#customer_tbl").append(newTr)
		    });
	    }); 
    }
    	var btn_add = document.getElementById("btn_add");
		var tbody = document.getElementsByTagName("tbody")[0];
		// 为表单绑定事件
		$("tbody").on({
				mouseover:function(){
					this.className = "current"
				},
				mouseout:function(){
					this.className = ""
				}
			},'tr')
		// 给添加按钮绑定事件
		// btn_add.onclick = function(){
	    $("#btn_add").on("click",function(){
			document.querySelector("input[name=name]").value = "";
			document.querySelector("input[name=description]").value = "";
			document.querySelector("input[name=price]").value = "";
			document.querySelector("input[name=id]").value = "";
			document.forms[0].onsubmit = function(event){
		    
			// 1. 获取用户的输入
			    var id = document.querySelector("input[name=id]").value;
			    var name = document.querySelector("input[name=name]").value;
			    var description = document.querySelector("input[name=description]").value;
			    var price = document.querySelector("input[name=price]").value;
			    var url = baseURL+"/product/insertProduct";
			    var data ={
				    id:id,
				    name:name,
				    description:description,
				    price:price
			    };

			    $.post(url,data,function(a,b){
				    alert(a.message);
				    reloadData();
			    });
			    event.preventDefault();
		    }
		})



        tbody.onclick = function(event){
			if(event.target.nodeName === "A"){
				switch(event.target.className){
					case "btn_del":
						// 1. 先获取要删除的id
						var id = event.target.parentNode.parentNode.firstElementChild.firstElementChild.value;
						// 2. 编写ajax进行删除
						var url = baseURL+"/product/deleteProductById";
						var data = "id="+id;
						$.post(url,data,function(response,status){
							alert(response.message);
							reloadData();
						});
						break;
					case "btn_upd":
						var id = event.target.parentNode.parentNode.children[0].firstElementChild.value;
						var name = event.target.parentNode.parentNode.children[1].innerText;
						var description = event.target.parentNode.parentNode.children[2].innerText;
						var price = event.target.parentNode.parentNode.children[3].innerText;
						document.querySelector("input[name=name]").value = name;
						document.querySelector("input[name=description]").value = description;
						document.querySelector("input[name=price]").value = price;
						document.querySelector("input[name=id]").value = id;
						document.forms[0].onsubmit = function(event){
			            // 1. 获取用户的输入

			            var id = document.querySelector("input[name=id]").value;
			            var name = document.querySelector("input[name=name]").value;
			            var description = document.querySelector("input[name=description]").value;
			            var price = document.querySelector("input[name=price]").value;


			            var url = baseURL+"/product/updateProduct";
			            var data ={
				            id:id,
				            name:name,
				            description:description,
				            price:price
			            };

			            $.post(url,data,function(a,b){
				            alert(a.message);
				            reloadData();
			            });
			            event.preventDefault();
		                }

				    break;
				}
			}
		}
		reloadData();
</script>